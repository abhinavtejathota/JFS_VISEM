<!DOCTYPE html>
<html>
<head>
    <title>Batch-wise Timetable</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    	<style>
    	body {
        	font-family: "Segoe UI", Tahoma, Arial, sans-serif;
        	background: #f4f6f8;
        	padding: 20px;
        	color: #333;
    	}

    	h2 {
        	margin-bottom: 10px;
   		}

    	input[type="file"] {
        	margin-bottom: 20px;
        	padding: 6px;
    	}

    	#tables > div {
        	background: #ffffff;
        	padding: 20px;
        	border-radius: 10px;
        	box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        	max-width: 1000px;
        	margin: 0 auto 40px;
    	}

    	.batch-title {
        	font-weight: 600;
        	font-size: 22px;
        	margin-bottom: 12px;
        	color: #0b5394;
    	}

    	button {
        	background: #0b5394;
        	color: white;
        	border: none;
        	padding: 8px 14px;
        	border-radius: 6px;
        	cursor: pointer;
        	font-size: 14px;
        	margin-bottom: 15px;
        	transition: background 0.2s ease;
    	}

    	button:hover {
        	background: #083763;
    	}

    	table {
        	width: 100%;
        	border-collapse: collapse;
        	table-layout: fixed;
    	}

    	th, td {
        	border: 1px solid #ccc;
        	padding: 10px;
        	text-align: center;
        	vertical-align: middle;
        	font-size: 14px;
        	word-wrap: break-word;
    	}

    	th {
        	background: #e7f1ff;
        	font-weight: 600;
    	}

    	td {
        	background: #fafafa;
    	}

    	tr:hover td {
        	background: #f1f7ff;
    	}

    	th[rowspan] {
        	background: #ffe599;
        	font-weight: bold;
        	letter-spacing: 2px;
    	}

    	@media print {
        	body {
            	background: white;
        	}
        	button, input {
            	display: none;
        	}
        	#tables > div {
            	box-shadow: none;
            	border: none;
        	}
    	}
	</style>
</head>
<body>

<h2>Upload CSV File</h2>
<input type="file" id="csvFile" accept=".csv">
<label>
    Employee ID:
    <input type="text" id="empId" placeholder="Enter Employee ID">
</label>


<div id="tables"></div>

<script>
document.getElementById("csvFile").addEventListener("change", function () {
    Papa.parse(this.files[0], {
        header: true,
        skipEmptyLines: true,
        complete: function (result) {
            processCSV(result.data);
        }
    });
});

document.getElementById("empId").addEventListener("input", () => {
    document.getElementById("csvFile").dispatchEvent(new Event("change"));
});
	
function processCSV(data) {
    const timetable = {};
    const batchFaculty = {}; 

    data.forEach(row => {
        const batch = row["BATCH"];
        const day = row["DAY"];
        const session = row["SESSION"];
        const course = row["COURSE"];
        const room = row["ROOM"];
        const faculty = row["FACULTY"];

        if (!batch || !day || !session) return;

        if (!timetable[batch]) {
            timetable[batch] = {};
            batchFaculty[batch] = new Set(); 
        }

        batchFaculty[batch].add(faculty); 

        if (!timetable[batch][day]) {
            timetable[batch][day] = { FN: "", AN: "" };
        }

        timetable[batch][day][session] =
            `${course}<br>Room: ${room}<br>Faculty: ${faculty}`;
    });

    buildTables(timetable, batchFaculty);
}
function buildTables(timetable, batchFaculty) {
    const container = document.getElementById("tables");
    container.innerHTML = "";

    const empId = document.getElementById("empId").value.trim();
    const days = ["MON", "TUE", "WED", "THU", "FRI", "SAT"];

    for (const batch in timetable) {

        if (empId && !Array.from(batchFaculty[batch]).some(f => f.includes(empId))) {
            continue;
        }

        const wrapper = document.createElement("div");

        const title = document.createElement("div");
        title.className = "batch-title";
        title.innerHTML = `Batch: ${batch}`;

        const btn = document.createElement("button");
        btn.innerHTML = "Print This Timetable";
        btn.onclick = () => printTable(batch);

        const table = document.createElement("table");
        table.id = `table_${batch}`;

        let html =
            "<tr><th>DAY</th><th>FN</th><th rowspan='7'>L<br>U<br>N<br>C<br>H</th><th>AN</th></tr>";

        days.forEach(day => {
            const fn = timetable[batch][day]?.FN || "";
            const an = timetable[batch][day]?.AN || "";
            html += `
                <tr>
                    <td>${day}</td>
                    <td>${fn}</td>
                    <td>${an}</td>
                </tr>
            `;
        });

        table.innerHTML = html;

        wrapper.append(title, btn, table);
        container.appendChild(wrapper);
    }
}

function printTable(batch) {
    const tableHTML = document.getElementById(`table_${batch}`).outerHTML;
    const title = `<h2>Batch: ${batch}</h2>`;

    const printWindow = window.open("", "", "width=900,height=600");
    printWindow.document.write(`
        <html>
        <head>
            <title>Print</title>
            <style>
                table { width: 100%; border-collapse: collapse; }
                th, td { border: 1px solid black; padding: 8px; text-align: center; }
                th { background: lightblue; }
            </style>
        </head>
        <body>
            ${title}
            ${tableHTML}
        </body>
        </html>
    `);

    printWindow.document.close();
    printWindow.print();
}
</script>
</body>
</html>
